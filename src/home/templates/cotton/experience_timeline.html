{% load i18n %}
{% load filters %}

<ul id="{{ list_id|default:'timeline-list' }}"
    class="list-none timeline timeline-snap-icon max-md:timeline-compact timeline-vertical">
    {% for item in items %}
        <li id="{{ item_type|default:'item' }}-{{ item.id }}-item">
            {% if not forloop.first %}
                <hr />
            {% endif %}
            <div class="timeline-middle text-primary">
                <svg xmlns="http://www.w3.org/2000/svg"
                     viewBox="0 0 20 20"
                     fill="currentColor"
                     class="h-5 w-5">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                </svg>
            </div>
            <div class="mb-10! w-full {% if forloop.counter|divisibleby:2 %}timeline-start md:text-end{% else %}timeline-end{% endif %}">
                <time id="{{ item_type|default:'item' }}-{{ item.id }}-period"
                      class="font-mono text-primary">
                    {{ item.period }}
                </time>
                <div id="{{ item_type|default:'item' }}-{{ item.id }}-duration"
                     class="font-mono text-primary">
                    ({{ item.duration }})
                </div>
                <div id="{{ item_type|default:'item' }}-{{ item.id }}-title"
                     class="text-lg font-black mt-5">
                    {{ item.title }}
                </div>
                {% if item.institution %}
                    <div id="{{ item_type|default:'item' }}-{{ item.id }}-institution"
                         class="font-mono text-secondary">
                        {{ item.institution }}
                    </div>
                {% endif %}
                <div id="{{ item_type|default:'item' }}-{{ item.id }}-location"
                     class="font-mono text-secondary">
                    {{ item.location }}
                </div>
                {% if item.technologies %}
                    <div id="{{ item_type|default:'item' }}-{{ item.id }}-technologies"
                         class="mt-2">
                        {% for tech in item.technologies.all %}
                            <span id="{{ item_type|default:'item' }}-{{ item.id }}-technology-{{ tech.id }}"
                                  class="badge badge-neutral mb-1">
                                {{ tech.name }}
                            </span>
                        {% endfor %}
                    </div>
                {% endif %}
                <div class="mb-1">
                    <!-- Button to show modal with item info -->
                    <button id="{{ item_type|default:'item' }}-{{ item.id }}-more-button"
                            class="btn btn-ghost"
                            onclick="{{ item_type|default:'item' }}_{{ item.id }}_modal.showModal()">
                        <svg class="h-5 w-5"
                             viewBox="0 0 20 20"
                             xmlns="http://www.w3.org/2000/svg"
                             xmlns:xlink="http://www.w3.org/1999/xlink"
                             xmlns:sketch="http://www.bohemiancoding.com/sketch/ns"
                             fill="currentColor">
                            <path fill-rule="evenodd" d="M10 3a7 7 0 100 14 7 7 0 000-14zm-9 7a9 9 0 1118 0 9 9 0 01-18 0zm14 .069a1 1 0 01-1 1h-2.931V14a1 1 0 11-2 0v-2.931H6a1 1 0 110-2h3.069V6a1 1 0 112 0v3.069H14a1 1 0 011 1z">
                            </path>
                        </svg>
                    </button>
                </div>
            </div>
            <dialog id="{{ item_type|default:'item' }}_{{ item.id }}_modal" class="modal">
                <div class="modal-box w-11/12 max-w-5xl flex flex-col max-md:p-4">
                    <div class="flex-1 overflow-y-auto">
                        <h3 id="modal-{{ item_type|default:'item' }}-{{ item.id }}-title"
                            class="text-lg font-bold">
                            {{ item.title }}
                        </h3>
                        <time id="modal-{{ item_type|default:'item' }}-{{ item.id }}-period"
                              class="font-mono text-primary">
                            {{ item.period }}
                        </time>
                        <div id="modal-{{ item_type|default:'item' }}-{{ item.id }}-duration"
                             class="font-mono text-primary">
                            ({{ item.duration }})
                        </div>
                        {% if item.institution %}
                            <div id="modal-{{ item_type|default:'item' }}-{{ item.id }}-institution"
                                 class="font-mono text-secondary">
                                {{ item.institution }}
                            </div>
                        {% endif %}
                        <div id="modal-{{ item_type|default:'item' }}-{{ item.id }}-location"
                             class="font-mono text-secondary">
                            {{ item.location }}
                        </div>
                        {% if item.technologies %}
                            <div id="modal-{{ item_type|default:'item' }}-{{ item.id }}-technologies"
                                 class="mt-2">
                                {% for tech in item.technologies.all %}
                                    <span id="modal-{{ item_type|default:'item' }}-{{ item.id }}-technology-{{ tech.id }}"
                                          class="badge badge-neutral mb-1">
                                        {{ tech.name }}
                                    </span>
                                {% endfor %}
                            </div>
                        {% endif %}
                        <div id="modal-{{ item_type|default:'item' }}-{{ item.id }}-description"
                             class="prose max-w-none py-4">
                            {{ item.description|md }}
                        </div>
                        {% comment %} Sub-projects section - only shown if item has sub_projects {% endcomment %}
                        {% if item.sub_projects.exists %}
                            <div id="{{ item_type|default:'item' }}-{{ item.id }}-subprojects"
                                 class="mt-6 border-t pt-6">
                                <h4 id="{{ item_type|default:'item' }}-{{ item.id }}-subprojects-title"
                                    class="text-md font-semibold mb-4 text-primary">
                                    {% translate "Projects" %}
                                </h4>
                                <div class="space-y-3">
                                    {% for sub_project in item.sub_projects.all %}
                                        <details class="collapse collapse-arrow bg-base-200"
                                                 name="subprojects-{{ item.id }}-accordion"
                                                 {% if forloop.first %}open{% endif %}>
                                            <summary class="collapse-title">
                                                <div class="flex justify-between items-start gap-4">
                                                    <div class="flex-1">
                                                        <h4 id="{{ item_type|default:'item' }}-{{ item.id }}-subproject-{{ sub_project.id }}-title"
                                                            class="font-semibold">
                                                            {{ sub_project.title }}
                                                        </h4>
                                                        {% if sub_project.client %}
                                                            <div id="{{ item_type|default:'item' }}-{{ item.id }}-subproject-{{ sub_project.id }}-client"
                                                                 class="font-mono text-sm text-secondary">
                                                                {{ sub_project.client }}
                                                            </div>
                                                        {% endif %}
                                                        {% if sub_project.technologies %}
                                                            <div id="{{ item_type|default:'item' }}-{{ item.id }}-subproject-{{ sub_project.id }}-technologies"
                                                                 class="mt-2">
                                                                {% for tech in sub_project.technologies.all %}
                                                                    <span id="{{ item_type|default:'item' }}-{{ item.id }}-subproject-{{ sub_project.id }}-technology-{{ tech.id }}"
                                                                          class="badge badge-neutral badge-sm mb-1">
                                                                        {{ tech.name }}
                                                                    </span>
                                                                {% endfor %}
                                                            </div>
                                                        {% endif %}
                                                    </div>
                                                    <div class="flex flex-col text-end">
                                                        <time id="{{ item_type|default:'item' }}-{{ item.id }}-subproject-{{ sub_project.id }}-period"
                                                              class="text-xs font-mono text-primary whitespace-nowrap">
                                                            {{ sub_project.period }}
                                                        </time>
                                                        <div id="{{ item_type|default:'item' }}-{{ item.id }}-subproject-{{ sub_project.id }}-duration"
                                                             class="text-xs font-mono text-primary">
                                                            ({{ sub_project.duration }})
                                                        </div>
                                                    </div>

                                                </div>
                                            </summary>
                                            <div class="collapse-content">
                                                <div id="{{ item_type|default:'item' }}-{{ item.id }}-subproject-{{ sub_project.id }}-description"
                                                     class="prose prose-sm max-w-none pt-2">
                                                    {{ sub_project.description|md }}
                                                </div>
                                            </div>
                                        </details>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    <div class="modal-action">
                        <form method="dialog">
                            <button class="btn">
                                Close
                            </button>
                        </form>
                    </div>
                </div>
            </dialog>
            {% if not forloop.last %}
                <hr />
            {% endif %}
        </li>
    {% endfor %}
</ul>
